{% extends "admin/base.html" %}

{% block content %}
<h1>Clicks Dashboard</h1>

<style>
    table {
        border-collapse: collapse;
        width: 100%;
    }
    th, td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
    }
</style>

<table role="grid" aria-describedby="clicks-table-desc">
    <caption id="clicks-table-desc" class="visually-hidden">Clicks data by store and element</caption>
    <thead>
        <tr>
            <th>Store</th>
            <th>Element</th>
            <th>Total Clicks</th>
        </tr>
    </thead>
    <tbody>
        {% for data in clicks_data %}
        <tr>
            <td>{{ data.store__name }}</td>
            <td>{{ data.element_type }}</td>
            <td>{{ data.total_clicks }}</td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="3">No click data available</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% if clicks_data %}
<div style="width: 100%; max-width: 600px;">
    <canvas id="clicksChart" aria-label="Bar chart showing clicks per element" role="img"></canvas>
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
<script>
    const ctx = document.getElementById('clicksChart')?.getContext('2d');
    if (ctx) {
        const data = {
            labels: [
                {% for data in clicks_data %}
                "{{ data.store__name|escapejs }} - {{ data.element_type|escapejs }}"{% if not forloop.last %},{% endif %}
                {% endfor %}
            ],
            datasets: [{
                label: 'Clicks',
                data: [
                    {% for data in clicks_data %}
                    {{ data.total_clicks }}{% if not forloop.last %},{% endif %}
                    {% endfor %}
                ],
                backgroundColor: [
                    '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0',
                    '#9966FF', '#FF9F40', '#C9CBCF', '#7BC225'
                ],
                borderColor: [
                    '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0',
                    '#9966FF', '#FF9F40', '#C9CBCF', '#7BC225'
                ],
                borderWidth: 1
            }]
        };
        new Chart(ctx, {
            type: 'bar',
            data: data,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: { display: true, text: 'Number of Clicks' }
                    },
                    x: {
                        title: { display: true, text: 'Store - Element' }
                    }
                },
                plugins: {
                    legend: { display: true },
                    title: { display: true, text: 'Clicks per Element' }
                }
            }
        });
    }
</script>
{% else %}
<p>No data available to display the chart.</p>
{% endif %}
{% endblock %}